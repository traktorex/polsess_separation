# SPMamba 2-Stage Hyperparameter Optimization
# Stage 2: Refined search on 8K samples
# NOTE: Update ranges after Stage 1 completes!

program: train_sweep.py
method: bayes
metric:
  name: best_val_sisdr
  goal: maximize

early_terminate:
  type: hyperband
  min_iter: 10  # Stage 2 runs longer, allow more warmup
  s: 2

parameters:
  # Fixed parameters
  config:
    value: experiments/spmamba/3-hyperparamopt/spmamba_8000.yaml
  
  num_epochs:
    value: 80
  
  seed:
    values: [42]
  
  early_stopping_patience:
    value: 10
  
  # ========================================
  # REFINED RANGES (from Stage 1 analysis)
  # ========================================
  # Based on 19 Stage 1 runs (6 complete):
  #   Top-2: 2.50 dB (lr=5.6e-4), 2.44 dB (lr=1.6e-3)
  #   Worst: 0.64 dB (wd=7e-5, too high)
  
  lr:
    distribution: log_uniform_values
    min: 3e-4    # Top-5 range: [5.3e-4, 1.6e-3], slight expansion
    max: 2e-3
  
  weight_decay:
    distribution: log_uniform_values
    min: 1e-6    # Top-5 range: [2e-6, 3e-5]
    max: 5e-5    # High WD (7e-5) caused worst run (0.64 dB)
  
  grad_clip_norm:
    distribution: uniform
    min: 1.5     # Stage 1 range was wide (1.7-8.3), narrowing slightly
    max: 10.0
  
  lr_factor:
    distribution: uniform
    min: 0.3    # Top-2 used 0.83 and 0.71; shift distribution higher
    max: 0.90
    
  lr_patience:
    values: [1, 2, 3]


project: polsess-thesis-experiments
name: spmamba-stage2-8k
